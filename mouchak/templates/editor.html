{% extends "base.html" %}

{% block head %}
  <link rel="stylesheet" href="{{url_for('static', filename='css/editor.css')}}">
  <title> Editing.. | {{ title }} </title>
{% endblock %}

{% block body %}
  <div class="container" id="container">
    <div id="header">
      <div id="hud">
        <span class="pull-right">Howdy! | <a href="{{ url_for('logout') }}">Logout</a></span>
      </div>
      <div id="notifications"></div>
    </div>
    <div id="content-container">
    </div>
    <div id="footer">
    </div>
  </div>

  <script>
    // initialize editor
    window.M = window.M || {};
    M.MenuURL = function() { return "{{ url_for('insertMenu') }}"};
    M.PageURL = function() { return "{{ url_for('insertPage') }}"};
    M.site_content = {{ content|tojson|safe }};
    window.onload = function() {
      M.editor.init();
    };
  </script>
{% endblock %}

{% block scripts %}
  <script src="{{url_for('static', filename='js/lib/tinymce/tinymce.min.js')}}"></script>
  <script src="{{url_for('static', filename='js/lib/tinymce/jquery.tinymce.min.js')}}"></script>
  <script src="{{url_for('static', filename='js/lib/ace/ace.js')}}"></script>
  <script src="{{url_for('static', filename='js/mouchak.js')}}"></script>
  <script src="{{url_for('static', filename='js/models.js')}}"></script>
  <script src="{{url_for('static', filename='js/views.js')}}"></script>
  <script src="{{url_for('static', filename='js/editor.js')}}"></script>
{% endblock %}

{% block templates %}

  <!-- Underscore templates -->
  <script type="text/template" id="menu-config-template">
    <div class="page">
      <div class="menu-config">
        <h4> Menu Config </h4>

        <div class="form-group col-lg-6" id="menu-order-wrap">
          <div class="input-group">
            <span class="input-group-addon"> <strong> Menu Order</strong></span>
            <input class="form-control" id="menu-order" type="text"
            placeholder="list,page,names,for,menu,order" value="<%= menu_order %>">
          </div>
        </div>

        <div class="form-group col-lg-6">
          <input class="form-control"  id="custom-menu" type="checkbox">
          <span class=""><strong> Custom Menu </strong></span>
        </div>

        <div class="menu-options" style="display: none;">
          <div class="form-group col-lg-6">
            <div class="input-group">
              <span class="input-group-addon"> <strong> Position </strong></span>
              <input class="form-control"  id="pos" type="text" placeholder="[left, top]"
              value="<%= pos %>">
            </div>
          </div>
          <label><strong> HTML for menu: </strong></label>
          <textarea cols="25" rows="8" id="menu"><%= menu %></textarea>
        </div>

      </div>
      <button id="updateMenu" class="btn btn-primary pull-right"> Update </button>
      <div class="clearfix"></div>
    </div>
  </script>

  <script type="text/template" id="page-list-template">
    <div id="pagelistview">
      <h4> List of Pages </h4>
      <div id="pagelist"></div>
      <button class="btn btn-primary" id="addPage">Add Page</button>
      <hr>
      <p> <a href="javascript:void(0);" id="menu-config"> Site Menu </a> </p>
      <p><a href="{{ url_for('index') }}"> Go to site </a></p>
    </div>
  </script>

  <script type="text/template" id="page-list-item-template">
    <div class="pagename">
      <a class="disp" id="<%= id %>" href="javascript:void(0);"><%= name %></a>
      <span class="pull-right">
        <a href="javascript:void(0);" class="remove" for="<%= id %>">
          <span class="glyphicon glyphicon-trash"></span>
        </a>
      </span>
      <span class="clearfix"></span>
    </div>
  </script>

  <script type="text/template" id="page-template">
    <div class="page">
      <h4> Page Details </h4>
      <form class="form-horizontal">
        <div class="form-group">
          <div class="input-group">
            <span class="input-group-addon"> <strong> Name </strong></span>
            <input class="form-control"  id="name" type="text" placeholder="name of the page" value="<%= name %>">
          </div>
        </div>
        <div class="form-group">
          <div class="input-group">
            <span class="input-group-addon"> <strong>Title</strong> </span>
            <input class="form-control"  id="title" type="text" placeholder="title of the page"
             value="<%= title %>">
          </div>
        </div>
        <div class="form-group">
          <div class="input-group">
            <span class="input-group-addon"> <strong>Children</strong> </span>
            <input class="form-control"  id="children" type="text" placeholder="csv of child pages"
            value="<%= children %>">
          </div>
        </div>
        <div class="form-group">
          <div class="input-group">
              <span class="input-group-addon">
                <input id="showNav" type="checkbox" <%= checked %> >
              </span>
              <input class="form-control" type="text" value="Show Navigation"
              disabled>
          </div>
        </div>
        <label><strong> Content </strong></label>
        <div id="content" class="content well">
          <%= content %>
          <p></p>
          <button class="addContent btn btn-sm btn-primary">Add Content</button>
        </div>
        <button id="updatePage" type="submit" class="btn btn-primary pull-right"> Update </button>
        <div class="clearfix"></div>
      </form>
    </div>
  </script>

  <script type="text/template" id="content-list-template">
    <div class="content-item-wrapper">
      <span class="content-item" id="content-<%= no %>">
        <span class="label label-default"> <%= type %> </span>
        <span class="content-snippet">
          [ <small> <%= title %>  <%= more %> </small> ]
        </span>
      </span>
      <span class="pull-right">
        <a href="javascript:void(0);" class="remove" for="<%=no%>">
          <span class="glyphicon glyphicon-trash"></span>
        </a>
      </span>
      <span class="clearfix"></span>
    </div>
  </script>

  <script type="text/template" id="content-template">
    <div class="contentview">
      <form class="form-horizontal">
        <div class="row">
          <div class="form-group col-lg-6">
            <label><b>Type</b></label>
            <select class="form-control">
              <% _.each(M.contentTypes, function(type) { %>
                <option><%= type %></option>
                <%  }); %>
            </select>
          </div>
        </div>
        <div class="row">
          <div class="form-group col-lg-6">
            <div class="input-group">
              <span class="input-group-addon"> <b>Title</b> </span>
              <input class="form-control"  type="text" placeholder="title of the content" value="<%=
              title %>" m-data-target="title">
            </div>
          </div>
        </div>
        <div class="row">
          <div class="form-group col-lg-6">
            <div class="input-group">
              <span class="input-group-addon"> <strong>Tags</strong> </span>
              <input class="form-control"  type="text" placeholder="csv of tags for this content"
              value="<%= tags %>" m-data-target="tags">
            </div>
          </div>
        </div>
      </form>
      <div class="row">
        <div id="specific-content"></div>
      </div>
      <div class="row">
        <button class="btn btn-info" id="done">Done</button>
        <button class="btn btn-primary" id="updateContent">Update</button>
      </div>
    </div>
  </script>

  <script type="text/template" id="map-template">
    <div class="data">
      <div class="row">
        <div class="form-group col-lg-6">
          <div class="input-group">
            <span class="input-group-addon"><strong>Tile Provider URL</strong></span>
            <input class="form-control" type="text" placeholder="http://{s}.tile.cloudmade.com/<API_KEY>/997/256/{z}/{x}/{y}.png" value="<%= tileLayer %>"
            m-data-target="tileLayer">
          </div>
        </div>
      </div>
      <div class="row">
        <div class="form-group col-lg-6">
          <div class="input-group">
            <span class="input-group-addon"><strong>Shapefile</strong></span>
            <input class="form-control" type="text" placeholder="" value="<%= shp %>"
            m-data-target="shp">
          </div>
        </div>
      </div>
      <div class="preview"></div>
    </div>
  </script>


  <script type="text/template" id="media-template">
    <div class="data">
      <div class="form-group col-lg-6">
        <div class="input-group">
          <span class="input-group-addon"><strong>path to file</strong></span>
          <input class="form-control" type="text" placeholder="src" value="<%= src %>"
          m-data-target="src">
        </div>
      </div>
      <div class="preview"></div>
    </div>
  </script>

  <script type="text/template" id="text-template">
    <div class="data">
      <div class="edit-type-wrap">
        <div class="row">
          <b> Content </b>
        </div>
        <div class="row">
          <div class="col-lg-4">
            <!-- code vs wysiwyg switch -->
            <div class="btn-group" id="edit-type">
              <button type="button" class="btn btn-default" value="wysiwyg">WYSIWYG</button>
              <button type="button" class="btn btn-default" value="code">Code</button>
            </div>
            <p class="help-block">
              <span class="label label-info">Heads Up!</span> 
              <span><small><b> Switch editing mode </b></small></span>
            </p>
          </div>
        </div>
      </div>
      <div class="row">
        <% if(wysiwyg === true) { %>
        <textarea id="edit" m-data-target="data">
          <%= data %>
        </textarea>
        <% } else { %>
        <div id="code-edit" m-data-target="data">
          <%= M.escapeHtml(data) %>
        </div>
        <% } %>
      </div>
    </div>
  </script>

  <!-- notification templates -->
  <script type="text/template" id="success-notif">
    <div class="alert alert-success">
      <button type="button" class="close" data-dismiss="alert">&times;</button>
      <h4> <%= title %> </h4>
      <%= msg %>
    </div>
  </script>

  <script type="text/template" id="fail-notif">
    <div class="alert alert-danger">
      <button type="button" class="close" data-dismiss="alert">&times;</button>
      <h4> <%= title %> </h4>
      <%= msg %>
    </div>
  </script>
{% endblock %}
